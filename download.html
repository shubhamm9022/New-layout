<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Movie Download Debug</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .debug-info { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>Movie Download Debug</h1>
  <div id="debug-console" class="debug-info"></div>
  <div id="content"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // Debug logging function
    function debugLog(message, type = 'info') {
      const consoleDiv = document.getElementById('debug-console');
      consoleDiv.innerHTML += `<p class="${type}">${new Date().toLocaleTimeString()}: ${message}</p>`;
      console.log(message);
    }

    debugLog("Starting script execution...");

    try {
      const firebaseConfig = {
        apiKey: "AIzaSyDv1KgOL_CsLs4xV6KuYuk3TD6xqpnY-84",
        authDomain: "movievault-e650e.firebaseapp.com",
        databaseURL: "https://movievault-e650e-default-rtdb.firebaseio.com",
        projectId: "movievault-e650e",
        storageBucket: "movievault-e650e.firebasestorage.app",
        messagingSenderId: "61140580505",
        appId: "1:61140580505:web:d3216ca8bd944662a22008"
      };

      debugLog("Initializing Firebase...");
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      debugLog("Firebase initialized successfully", 'success');

      const urlParams = new URLSearchParams(window.location.search);
      const movieId = urlParams.get('id');
      debugLog(`URL Parameter 'id': ${movieId}`);

      if (!movieId || !movieId.match(/^.+-.+-.+$/)) {
        throw new Error("Invalid URL format. Use: ?id=MovieName-Year-Quality");
      }

      const [name, year, quality] = movieId.split('-');
      debugLog(`Parsed: Name=${name}, Year=${year}, Quality=${quality}`);

      const dbPath = `movies/${name} (${year})/${quality}`;
      debugLog(`Attempting to fetch from Firebase path: ${dbPath}`);

      const dbRef = ref(db, dbPath);
      const snapshot = await get(dbRef);
      
      if (!snapshot.exists()) {
        throw new Error("No data found at this path");
      }

      const data = snapshot.val();
      debugLog("Retrieved data:", 'success');
      debugLog(JSON.stringify(data, null, 2));

      // Display content
      document.getElementById('content').innerHTML = `
        <h2>${name} (${year}) - ${quality}</h2>
        <h3>Download Links:</h3>
        ${data.filepress ? `<p><a href="${data.filepress}" target="_blank">FilePress</a></p>` : ''}
        ${data.neodrive ? `<p><a href="${data.neodrive}" target="_blank">NeoDrive</a></p>` : ''}
        ${data.backup ? `<p><a href="${data.backup}" target="_blank">Backup</a></p>` : ''}
      `;

    } catch (error) {
      debugLog(`ERROR: ${error.message}`, 'error');
      document.getElementById('content').innerHTML = `
        <div class="error">
          <h2>Error Loading Content</h2>
          <p>${error.message}</p>
          <p>Check console for details</p>
        </div>
      `;
    }
  </script>
</body>
</html>
